<?php

namespace App\Console\Commands;

use Exception;
use Illuminate\Console\Command;
use stdClass;
use SWeb3\SWeb3;
use SWeb3\Utils;
use SWeb3\SWeb3_Contract;
use phpseclib\Math\BigInteger as BigNumber;

class IndexHistoryCron extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'index-history:cron';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Command description';

    /**
     * Execute the console command.
     *
     * @return int
     */
    public function handle(){
        //initialize SWeb3 main object
        $ETHEREUM_NET_ENDPOINT = 'https://bsc-dataseed1.binance.org/';
        $SWP_ADDRESS = '0x4081738adDa3D60B9B2c64b3548a390276467C1B';
        $SWP_PRIVATE_KEY = 'f97d31761ed0c379a16d4800665a2c1f9f41e477ed3981294a06a5f49ccaf979';

        $sweb3 = new SWeb3($ETHEREUM_NET_ENDPOINT);
        //send chain id, important for transaction signing 0x1 = main net, 0x3 ropsten... full list = https://chainlist.org/
        $sweb3->chainId = 56;//ropsten
        //set personal data for dending & signing
        $sweb3->setPersonalData($SWP_ADDRESS, $SWP_PRIVATE_KEY);
        //refresh  nonce
        $nonce =  $sweb3->personal->getNonce();

//initialize contract with empty address and contract abi
//contract used available at Examples/swp_contract_create.sol
        $creation_abi = '[{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"previousAdminRole","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"newAdminRole","type":"bytes32"}],"name":"RoleAdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleGranted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleRevoked","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"inputs":[],"name":"DEFAULT_ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"USDT","outputs":[{"internalType":"contract IERC20Metadata","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"USDTBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"VTI","outputs":[{"internalType":"contract IERC20Metadata","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"VTIBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint8","name":"_programType","type":"uint8"},{"internalType":"string","name":"_name","type":"string"},{"internalType":"string","name":"_date","type":"string"}],"name":"addProgram","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"addUSDT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"addVTI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_USDTAmount","type":"uint256"},{"internalType":"uint256","name":"_VTIPrice","type":"uint256"},{"internalType":"uint256","name":"_timeStamp","type":"uint256"},{"internalType":"uint256","name":"_openLimit","type":"uint256"},{"internalType":"uint8","name":"_code","type":"uint8"}],"name":"buyVTI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_USDTAmount","type":"uint256"},{"internalType":"uint256","name":"_VTIPrice","type":"uint256"},{"internalType":"address","name":"_userAddress","type":"address"},{"internalType":"uint8","name":"_code","type":"uint8"}],"name":"buyVTIfromBalance","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"}],"name":"getAllUserPrograms","outputs":[{"internalType":"uint8[]","name":"","type":"uint8[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"}],"name":"getBuyData","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getMFee","outputs":[{"internalType":"uint16","name":"","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"}],"name":"getMinSellAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"},{"internalType":"uint8","name":"_code","type":"uint8"}],"name":"getProgramBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"},{"internalType":"uint8","name":"_code","type":"uint8"}],"name":"getProgramBuyData","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleAdmin","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"}],"name":"getSellData","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"getUSDT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"}],"name":"getUserHistory","outputs":[{"components":[{"internalType":"uint8","name":"opType","type":"uint8"},{"internalType":"uint8","name":"opCode","type":"uint8"},{"internalType":"string","name":"opDate","type":"string"},{"internalType":"uint256","name":"VTIAmount","type":"uint256"},{"internalType":"uint256","name":"VTIPrice","type":"uint256"},{"internalType":"uint256","name":"totalUSDT","type":"uint256"}],"internalType":"struct INDEX_v5.HistoryRecord[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"getVTI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"}],"name":"getVTIBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"grantRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"hasRole","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"pause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"renounceRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"revokeRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_VTIAmount","type":"uint256"},{"internalType":"uint256","name":"_VTIPrice","type":"uint256"},{"internalType":"uint256","name":"_timeStamp","type":"uint256"}],"name":"sellVTI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_backAddress","type":"address"}],"name":"setBackAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint16","name":"_expTime","type":"uint16"}],"name":"setExpirationTime","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint16","name":"_newMFee","type":"uint16"}],"name":"setMFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_programsContract","type":"address"}],"name":"setProgramsContractAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint16","name":"_newSFee","type":"uint16"}],"name":"setSFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_systemWallet","type":"address"}],"name":"setSystemWallet","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_USDTContract","type":"address"}],"name":"setUSDTContractAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_VTIContract","type":"address"}],"name":"setVTIContractAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"unpause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint8","name":"_code","type":"uint8"}],"name":"withdrawFromProgram","outputs":[],"stateMutability":"nonpayable","type":"function"}]';
        $contract = new SWeb3_contract($sweb3, '0x9Fa34d811A3320872fFF11b9F479BE1ac4D4a208', $creation_abi);

//set contract bytecode data

        //$contract_bytecode = '608060405234801561001057600080fd5b506149fe806100206000396000f3fe608060405234801561001057600080fd5b50600436106102535760003560e01c80638129fc1c11610146578063c54e44eb116100c3578063d926c27d11610087578063d926c27d1461053d578063de46b02214610550578063e93711b614610563578063ebcd4ee21461056c578063ec1406ea1461058f578063f58f32f3146105a257600080fd5b8063c54e44eb146104db578063c5eeb6b2146104ee578063ca5d06751461050e578063d152763814610517578063d547741f1461052a57600080fd5b8063a217fddf1161010a578063a217fddf14610467578063a254c8171461046f578063b1a39ae71461048a578063b3143a211461049d578063c0274790146104b057600080fd5b80638129fc1c1461041e5780638456cb5914610426578063846ec37e1461042e57806391d14854146104415780639e6a4b261461045457600080fd5b80634bd0b14c116101d45780635c975abb116101985780635c975abb146103ac5780636192e087146103b757806370882848146103ca578063755f14ed146103dd5780637a657d8d1461040b57600080fd5b80634bd0b14c146103405780634fb3d3b11461035357806351b07a961461037357806352c280411461038657806359fcd3471461039957600080fd5b80632f2ff15d1161021b5780632f2ff15d146102ec5780633227f404146102ff57806336568abe146103125780633b8592f9146103255780633f4ba83a1461033857600080fd5b806301ffc9a7146102585780630a416ca6146102805780630b5c04341461029557806318e23340146102a8578063248a9ca3146102c9575b600080fd5b61026b610266366004613e0e565b6105b5565b60405190151581526020015b60405180910390f35b61029361028e366004613e38565b6105ec565b005b6102936102a3366004613e8a565b610cd7565b6102bb6102b6366004613ed2565b611561565b604051908152602001610277565b6102bb6102d7366004613f09565b60009081526065602052604090206001015490565b6102936102fa366004613f22565b6116f5565b61029361030d366004614005565b611720565b610293610320366004613f22565b611855565b61029361033336600461407b565b6118d3565b61029361191c565b61029361034e36600461407b565b61194d565b61036661036136600461407b565b611996565b60405161027791906140e6565b610293610381366004613f09565b611b00565b61029361039436600461418c565b611cc3565b6102936103a736600461407b565b611d02565b60975460ff1661026b565b6102936103c5366004613f09565b611d4b565b6102936103d836600461418c565b611fdd565b6103f06103eb366004613ed2565b612072565b60408051938452602084019290925290820152606001610277565b610293610419366004613f09565b61220f565b6102936123c4565b610293612461565b61029361043c3660046141b0565b612490565b61026b61044f366004613f22565b612ba1565b6102936104623660046141fd565b612bcc565b6102bb600081565b610477612ec2565b60405161ffff9091168152602001610277565b610293610498366004613f09565b612efe565b6102bb6104ab36600461407b565b613164565b60cc546104c3906001600160a01b031681565b6040516001600160a01b039091168152602001610277565b60cd546104c3906001600160a01b031681565b6105016104fc36600461407b565b6131bc565b604051610277919061421a565b6102bb60cf5481565b61029361052536600461418c565b613259565b610293610538366004613f22565b6132ed565b6103f061054b36600461407b565b613313565b6102bb61055e36600461407b565b61336c565b6102bb60ce5481565b61057f61057a36600461407b565b613405565b6040516102779493929190614261565b61029361059d36600461407b565b613535565b6102936105b036600461407b565b61357e565b60006001600160e01b03198216637965db0b60e01b14806105e657506301ffc9a760e01b6001600160e01b03198316145b92915050565b60975460ff16156106185760405162461bcd60e51b815260040161060f90614290565b60405180910390fd5b333b156106375760405162461bcd60e51b815260040161060f906142ba565b60c954429061064a9061ffff1683614305565b10156106685760405162461bcd60e51b815260040161060f90614318565b33600090815260ca60205260409020600881015460079091015461068c9190614360565b83116106ce5760405162461bcd60e51b81526020600482015260116024820152701b519959480f8815951248185b5bdd5b9d607a1b604482015260640161060f565b60c95433600090815260ca6020526040902060090154640757b12c009162010000900461ffff16906107009042614360565b33600090815260ca602052604090205461071a9190614373565b6107249190614373565b61072e91906143a0565b33600090815260ca602052604081206007018054909190610750908490614305565b909155505033600090815260ca60205260408120426009820155600881015460079091015461077f9190614360565b6107899085614360565b33600090815260ca602052604081206007810154600890910155909150670de0b6b3a76400006107b98584614373565b6107c391906143a0565b60cd546040516370a0823160e01b815230600482015291925082916001600160a01b03909116906370a0823190602401602060405180830381865afa158015610810573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061083491906143b4565b10156108825760405162461bcd60e51b815260206004820152601b60248201527f4e6f7420656e6f7567682055534454206f6e20636f6e74726163740000000000604482015260640161060f565b60cc546040516370a0823160e01b81523060048201526000916001600160a01b0316906370a0823190602401602060405180830381865afa1580156108cb573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906108ef91906143b4565b60cc546040516323b872dd60e01b81529192506001600160a01b0316906323b872dd90610924903390309088906004016143cd565b6020604051808303816000875af1158015610943573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061096791906143f1565b5060cc546040516370a0823160e01b8152306004820152849183916001600160a01b03909116906370a0823190602401602060405180830381865afa1580156109b4573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906109d891906143b4565b6109e29190614360565b146109ff5760405162461bcd60e51b815260040161060f90614413565b60cc5460d0546001600160a01b03918216916323b872dd91339116610a24878b614360565b6040518463ffffffff1660e01b8152600401610a42939291906143cd565b6020604051808303816000875af1158015610a61573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610a8591906143f1565b5060cd5460405163a9059cbb60e01b8152336004820152602481018490526001600160a01b039091169063a9059cbb906044016020604051808303816000875af1158015610ad7573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610afb91906143f1565b508160cf6000828254610b0e9190614360565b925050819055508560ce6000828254610b279190614305565b909155505033600090815260ca602052604081206003018054889290610b4e908490614305565b909155505033600090815260ca602052604081206005018054849290610b75908490614305565b909155505033600090815260ca602052604090206003810154600590910154610ba690670de0b6b3a7640000614373565b610bb091906143a0565b33600090815260ca602052604090206004810182905560010154670de0b6b3a764000091610bde919061443f565b33600090815260ca6020526040902060030154610bfb9190614466565b610c059190614496565b33600090815260ca6020526040902060060155610c20613dd2565b6001815260006020820152610c34426135c7565b6040808301918252606083018990526080830188905260a0830185905233600090815260cb602090815291812080546001818101835591835291839020855160059093020180549386015160ff9081166101000261ffff199095169316929092179290921781559151839291820190610cad908261454c565b50606082015181600201556080820151816003015560a08201518160040155505050505050505050565b60975460ff1615610cfa5760405162461bcd60e51b815260040161060f90614290565b333b15610d195760405162461bcd60e51b815260040161060f906142ba565b60d1546001600160a01b03163314610d845760405162461bcd60e51b815260206004820152602860248201527f4f6e6c79206261636b20616464726573732063616e2063616c6c207468697320604482015267333ab731ba34b7b760c11b606482015260840161060f565b60ff81161580610da75750600a8160ff1610158015610da75750601d8160ff1611155b610dc35760405162461bcd60e51b815260040161060f9061460c565b82600003610e035760405162461bcd60e51b815260206004820152600d60248201526c0565449207072696365203d203609c1b604482015260640161060f565b600083610e1886670de0b6b3a7640000614373565b610e2291906143a0565b60cc546040516370a0823160e01b815230600482015291925082916001600160a01b03909116906370a0823190602401602060405180830381865afa158015610e6f573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610e9391906143b4565b1015610eb15760405162461bcd60e51b815260040161060f90614643565b8060ce541015610efd5760405162461bcd60e51b815260206004820152601760248201527656544920616d6f756e74203e2056544942616c616e636560481b604482015260640161060f565b60cd5460d0546040516370a0823160e01b81526001600160a01b039182166004820152879291909116906370a0823190602401602060405180830381865afa158015610f4d573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610f7191906143b4565b1015610fbf5760405162461bcd60e51b815260206004820181905260248201527f4e6f7420656e6f7567682055534454206f6e2073797374656d2077616c6c6574604482015260640161060f565b60cd546040516370a0823160e01b81523060048201526000916001600160a01b0316906370a0823190602401602060405180830381865afa158015611008573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061102c91906143b4565b60cd5460d0546040516323b872dd60e01b81529293506001600160a01b03918216926323b872dd9261106692169030908b906004016143cd565b6020604051808303816000875af1158015611085573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906110a991906143f1565b5060cd546040516370a0823160e01b8152306004820152879183916001600160a01b03909116906370a0823190602401602060405180830381865afa1580156110f6573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061111a91906143b4565b6111249190614360565b146111415760405162461bcd60e51b815260040161060f90614413565b8260ff166000036113825760cc5460405163a9059cbb60e01b81526001600160a01b038681166004830152602482018590529091169063a9059cbb906044016020604051808303816000875af115801561119f573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906111c391906143f1565b506001600160a01b038416600090815260ca6020526040812060090154900361120a576001600160a01b038416600090815260ca60205260409020426009909101556112cc565b60c9546001600160a01b038516600090815260ca6020526040902060090154640757b12c009162010000900461ffff16906112459042614360565b6001600160a01b038716600090815260ca60205260409020546112689190614373565b6112729190614373565b61127c91906143a0565b6001600160a01b038516600090815260ca6020526040812060070180549091906112a7908490614305565b90915550506001600160a01b038416600090815260ca60205260409020426009909101555b6001600160a01b038416600090815260ca6020526040812080548492906112f4908490614305565b90915550506001600160a01b038416600090815260ca602052604081206002018054889290611324908490614305565b90915550506001600160a01b038416600090815260ca60205260409020805460029091015461135b90670de0b6b3a7640000614373565b61136591906143a0565b6001600160a01b038516600090815260ca60205260409020600101555b600a8360ff161015801561139a5750601d8360ff1611155b156114905760cc5460d25460405163a9059cbb60e01b81526001600160a01b0391821660048201526024810185905291169063a9059cbb906044016020604051808303816000875af11580156113f4573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061141891906143f1565b5060d254604051635ff6170d60e11b815260048101889052602481018490526001600160a01b03868116604483015260ff861660648301529091169063bfec2e1a90608401600060405180830381600087803b15801561147757600080fd5b505af115801561148b573d6000803e3d6000fd5b505050505b8560cf60008282546114a29190614305565b925050819055508160ce60008282546114bb9190614360565b909155506114c99050613dd2565b6000815260ff841660208201526114df426135c7565b6040808301918252606083018590526080830188905260a083018990526001600160a01b038716600090815260cb602090815291812080546001818101835591835291839020855160059093020180549386015160ff9081166101000261ffff199095169316929092179290921781559151839291820190610cad908261454c565b600061156f60975460ff1690565b1561158c5760405162461bcd60e51b815260040161060f90614290565b600a8260ff16101580156115a45750601d8260ff1611155b6115c05760405162461bcd60e51b815260040161060f9061460c565b60d254604051638cce24ed60e01b81526001600160a01b03858116600483015260ff8516602483015290911690638cce24ed90604401602060405180830381865afa158015611613573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061163791906143f1565b6116775760405162461bcd60e51b81526020600482015260116024820152704e6f207375636820612070726f6772616d60781b604482015260640161060f565b60d254604051633ed0d8f960e01b81526001600160a01b03858116600483015260ff8516602483015290911690633ed0d8f990604401602060405180830381865afa1580156116ca573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906116ee91906143b4565b9392505050565b6000828152606560205260409020600101546117118133613785565b61171b83836137e9565b505050565b60975460ff16156117435760405162461bcd60e51b815260040161060f90614290565b333b156117625760405162461bcd60e51b815260040161060f906142ba565b60018360ff1611156117ab5760405162461bcd60e51b815260206004820152601260248201527157726f6e672070726f6772616d207479706560701b604482015260640161060f565b8260ff166000036118215760d25460405163f368440560e01b81526001600160a01b039091169063f3684405906117ea90339086908690600401614684565b600060405180830381600087803b15801561180457600080fd5b505af1158015611818573d6000803e3d6000fd5b50505050505050565b60d25460405163aebd903f60e01b81526001600160a01b039091169063aebd903f906117ea90339086908690600401614684565b6001600160a01b03811633146118c55760405162461bcd60e51b815260206004820152602f60248201527f416363657373436f6e74726f6c3a2063616e206f6e6c792072656e6f756e636560448201526e103937b632b9903337b91039b2b63360891b606482015260840161060f565b6118cf828261386f565b5050565b6118de600033612ba1565b6118fa5760405162461bcd60e51b815260040161060f906146ba565b60cd80546001600160a01b0319166001600160a01b0392909216919091179055565b611927600033612ba1565b6119435760405162461bcd60e51b815260040161060f906146ba565b61194b6138d6565b565b611958600033612ba1565b6119745760405162461bcd60e51b815260040161060f906146ba565b60d180546001600160a01b0319166001600160a01b0392909216919091179055565b60606119a460975460ff1690565b156119c15760405162461bcd60e51b815260040161060f90614290565b6001600160a01b038216600090815260cb6020908152604080832080548251818502810185019093528083529193909284015b82821015611af45760008481526020908190206040805160c08101825260058602909201805460ff8082168552610100909104169383019390935260018301805492939291840191611a45906144c4565b80601f0160208091040260200160405190810160405280929190818152602001828054611a71906144c4565b8015611abe5780601f10611a9357610100808354040283529160200191611abe565b820191906000526020600020905b815481529060010190602001808311611aa157829003601f168201915b505050505081526020016002820154815260200160038201548152602001600482015481525050815260200190600101906119f4565b5050505090505b919050565b611b0b600033612ba1565b611b275760405162461bcd60e51b815260040161060f906146ba565b60cd546040516370a0823160e01b815230600482015282916001600160a01b0316906370a0823190602401602060405180830381865afa158015611b6f573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611b9391906143b4565b1015611be15760405162461bcd60e51b815260206004820152601b60248201527f4e6f7420656e6f7567682055534454206f6e20636f6e74726163740000000000604482015260640161060f565b8060cf541015611c335760405162461bcd60e51b815260206004820152601960248201527f5553445420616d6f756e74203e205553445442616c616e636500000000000000604482015260640161060f565b60cd5460405163a9059cbb60e01b8152336004820152602481018390526001600160a01b039091169063a9059cbb906044016020604051808303816000875af1158015611c84573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611ca891906143f1565b508060cf6000828254611cbb9190614360565b909155505050565b611cce600033612ba1565b611cea5760405162461bcd60e51b815260040161060f906146ba565b60c9805461ffff191661ffff92909216919091179055565b611d0d600033612ba1565b611d295760405162461bcd60e51b815260040161060f906146ba565b60cc80546001600160a01b0319166001600160a01b0392909216919091179055565b60975460ff1615611d6e5760405162461bcd60e51b815260040161060f90614290565b60cc546040516370a0823160e01b81523360048201526001600160a01b03909116906370a0823190602401602060405180830381865afa158015611db6573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611dda91906143b4565b811115611e215760405162461bcd60e51b8152602060048201526015602482015274139bdd08195b9bdd59da08159512481d1bc8185919605a1b604482015260640161060f565b60cc546040516370a0823160e01b81523060048201526000916001600160a01b0316906370a0823190602401602060405180830381865afa158015611e6a573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611e8e91906143b4565b60cc546040516323b872dd60e01b81529192506001600160a01b0316906323b872dd90611ec3903390309087906004016143cd565b6020604051808303816000875af1158015611ee2573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611f0691906143f1565b5060cc546040516370a0823160e01b8152306004820152839183916001600160a01b03909116906370a0823190602401602060405180830381865afa158015611f53573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611f7791906143b4565b611f819190614360565b14611fc25760405162461bcd60e51b81526020600482015260116024820152702b2a24902830bcb6b2b73a1032b93937b960791b604482015260640161060f565b8160ce6000828254611fd49190614305565b90915550505050565b611fe8600033612ba1565b6120045760405162461bcd60e51b815260040161060f906146ba565b6103e88161ffff16111561204e5760405162461bcd60e51b815260206004820152601160248201527077726f6e6720737563636573732066656560781b604482015260640161060f565b60c9805461ffff9092166401000000000265ffff0000000019909216919091179055565b600080600061208360975460ff1690565b156120a05760405162461bcd60e51b815260040161060f90614290565b600a8460ff16101580156120b85750601d8460ff1611155b6120d45760405162461bcd60e51b815260040161060f9061460c565b60d254604051638cce24ed60e01b81526001600160a01b03878116600483015260ff8716602483015290911690638cce24ed90604401602060405180830381865afa158015612127573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061214b91906143f1565b61218b5760405162461bcd60e51b81526020600482015260116024820152704e6f207375636820612070726f6772616d60781b604482015260640161060f565b60d254604051630bbfb2a760e11b81526001600160a01b03878116600483015260ff871660248301529091169063177f654e90604401606060405180830381865afa1580156121de573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061220291906146f1565b9250925092509250925092565b61221a600033612ba1565b6122365760405162461bcd60e51b815260040161060f906146ba565b60cc546040516370a0823160e01b815230600482015282916001600160a01b0316906370a0823190602401602060405180830381865afa15801561227e573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906122a291906143b4565b10156122f05760405162461bcd60e51b815260206004820152601a60248201527f4e6f7420656e6f75676820565449206f6e20636f6e7472616374000000000000604482015260640161060f565b8060ce54101561233c5760405162461bcd60e51b815260206004820152601760248201527656544920616d6f756e74203e2056544942616c616e636560481b604482015260640161060f565b60cc5460405163a9059cbb60e01b8152336004820152602481018390526001600160a01b039091169063a9059cbb906044016020604051808303816000875af115801561238d573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906123b191906143f1565b508060ce6000828254611cbb9190614360565b600054610100900460ff16806123dd575060005460ff16155b6123f95760405162461bcd60e51b815260040161060f9061471f565b600054610100900460ff1615801561241b576000805461ffff19166101011790555b612423613969565b61242b6139ec565b612436600033613a61565b60c9805465ffffffffffff191664c800140078179055801561245e576000805461ff00191690555b50565b61246c600033612ba1565b6124885760405162461bcd60e51b815260040161060f906146ba565b61194b613a6b565b60975460ff16156124b35760405162461bcd60e51b815260040161060f90614290565b333b156124d25760405162461bcd60e51b815260040161060f906142ba565b60c95442906124e59061ffff1685614305565b10156125035760405162461bcd60e51b815260040161060f90614318565b818511156125535760405162461bcd60e51b815260206004820152601e60248201527f5553445420616d6f756e742065786365656473206f70656e206c696d69740000604482015260640161060f565b60ff811615806125765750600a8160ff16101580156125765750601d8160ff1611155b6125925760405162461bcd60e51b815260040161060f9061460c565b6000846125a787670de0b6b3a7640000614373565b6125b191906143a0565b60cc546040516370a0823160e01b815230600482015291925082916001600160a01b03909116906370a0823190602401602060405180830381865afa1580156125fe573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061262291906143b4565b10156126405760405162461bcd60e51b815260040161060f90614643565b60cd546040516370a0823160e01b81523060048201526000916001600160a01b0316906370a0823190602401602060405180830381865afa158015612689573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906126ad91906143b4565b60cd546040516323b872dd60e01b81529192506001600160a01b0316906323b872dd906126e290339030908c906004016143cd565b6020604051808303816000875af1158015612701573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061272591906143f1565b5060cd546040516370a0823160e01b8152306004820152889183916001600160a01b03909116906370a0823190602401602060405180830381865afa158015612772573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061279691906143b4565b6127a09190614360565b146127bd5760405162461bcd60e51b815260040161060f90614413565b8260ff166000036129a25760cc5460405163a9059cbb60e01b8152336004820152602481018490526001600160a01b039091169063a9059cbb906044016020604051808303816000875af1158015612819573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061283d91906143f1565b5033600090815260ca602052604081206009015490036128725733600090815260ca6020526040902042600990910155612910565b60c95433600090815260ca6020526040902060090154640757b12c009162010000900461ffff16906128a49042614360565b33600090815260ca60205260409020546128be9190614373565b6128c89190614373565b6128d291906143a0565b33600090815260ca6020526040812060070180549091906128f4908490614305565b909155505033600090815260ca60205260409020426009909101555b33600090815260ca60205260408120805484929061292f908490614305565b909155505033600090815260ca602052604081206002018054899290612956908490614305565b909155505033600090815260ca60205260409020805460029091015461298490670de0b6b3a7640000614373565b61298e91906143a0565b33600090815260ca60205260409020600101555b600a8360ff16101580156129ba5750601d8360ff1611155b15612aae5760cc5460d25460405163a9059cbb60e01b81526001600160a01b0391821660048201526024810185905291169063a9059cbb906044016020604051808303816000875af1158015612a14573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190612a3891906143f1565b5060d254604051635ff6170d60e11b8152600481018990526024810184905233604482015260ff851660648201526001600160a01b039091169063bfec2e1a90608401600060405180830381600087803b158015612a9557600080fd5b505af1158015612aa9573d6000803e3d6000fd5b505050505b8660cf6000828254612ac09190614305565b925050819055508160ce6000828254612ad99190614360565b90915550612ae79050613dd2565b6000815260ff84166020820152612afd426135c7565b6040808301918252606083018590526080830189905260a083018a905233600090815260cb602090815291812080546001818101835591835291839020855160059093020180549386015160ff9081166101000261ffff199095169316929092179290921781559151839291820190612b76908261454c565b50606082015181600201556080820151816003015560a0820151816004015550505050505050505050565b60009182526065602090815260408084206001600160a01b0393909316845291905290205460ff1690565b60975460ff1615612bef5760405162461bcd60e51b815260040161060f90614290565b333b15612c0e5760405162461bcd60e51b815260040161060f906142ba565b600a8160ff1610158015612c265750601d8160ff1611155b612c425760405162461bcd60e51b815260040161060f9061460c565b60d254604051630c2bf51760e21b815233600482015260ff83166024820152600091829182916001600160a01b0316906330afd45c906044016060604051808303816000875af1158015612c9a573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190612cbe91906146f1565b60c95433600090815260ca60205260409020600901549396509194509250640757b12c00916201000090910461ffff1690612cf99042614360565b33600090815260ca6020526040902054612d139190614373565b612d1d9190614373565b612d2791906143a0565b33600090815260ca602052604081206007018054909190612d49908490614305565b909155505033600090815260ca602052604081204260098201558054859290612d73908490614305565b909155505033600090815260ca602052604081206002018054849290612d9a908490614305565b909155505033600090815260ca602052604090208054600290910154612dc890670de0b6b3a7640000614373565b612dd291906143a0565b33600090815260ca60205260408120600181019290925560079091018054839290612dfe908490614305565b90915550612e0c9050613dd2565b6002815260ff85166020820152612e22426135c7565b60408083019182526060830186905260006080840181905260a0840186905233815260cb602090815291812080546001818101835591835291839020855160059093020180549386015160ff9081166101000261ffff199095169316929092179290921781559151839291820190612e9a908261454c565b50606082015181600201556080820151816003015560a0820151816004015550505050505050565b6000612ed060975460ff1690565b15612eed5760405162461bcd60e51b815260040161060f90614290565b5060c95462010000900461ffff1690565b60975460ff1615612f215760405162461bcd60e51b815260040161060f90614290565b60cd546040516370a0823160e01b81523360048201526001600160a01b03909116906370a0823190602401602060405180830381865afa158015612f69573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190612f8d91906143b4565b811115612fd55760405162461bcd60e51b8152602060048201526016602482015275139bdd08195b9bdd59da081554d115081d1bc818591960521b604482015260640161060f565b60cd546040516370a0823160e01b81523060048201526000916001600160a01b0316906370a0823190602401602060405180830381865afa15801561301e573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061304291906143b4565b60cd546040516323b872dd60e01b81529192506001600160a01b0316906323b872dd90613077903390309087906004016143cd565b6020604051808303816000875af1158015613096573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906130ba91906143f1565b5060cd546040516370a0823160e01b8152306004820152839183916001600160a01b03909116906370a0823190602401602060405180830381865afa158015613107573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061312b91906143b4565b6131359190614360565b146131525760405162461bcd60e51b815260040161060f90614413565b8160cf6000828254611fd49190614305565b600061317260975460ff1690565b1561318f5760405162461bcd60e51b815260040161060f90614290565b6001600160a01b038216600090815260ca6020526040902060088101546007909101546105e69190614360565b60606131ca60975460ff1690565b156131e75760405162461bcd60e51b815260040161060f90614290565b60d2546040516362f75b5960e11b81526001600160a01b0384811660048301529091169063c5eeb6b290602401600060405180830381865afa158015613231573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526105e6919081019061476d565b613264600033612ba1565b6132805760405162461bcd60e51b815260040161060f906146ba565b6103e88161ffff1611156132cd5760405162461bcd60e51b815260206004820152601460248201527377726f6e67206d616974616e616e63652066656560601b604482015260640161060f565b60c9805461ffff909216620100000263ffff000019909216919091179055565b6000828152606560205260409020600101546133098133613785565b61171b838361386f565b600080600061332460975460ff1690565b156133415760405162461bcd60e51b815260040161060f90614290565b5050506001600160a01b0316600090815260ca60205260409020805460018201546002909201549092565b600061337a60975460ff1690565b156133975760405162461bcd60e51b815260040161060f90614290565b60cc546040516370a0823160e01b81526001600160a01b038481166004830152909116906370a0823190602401602060405180830381865afa1580156133e1573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906105e691906143b4565b6000806000606061341860975460ff1690565b156134355760405162461bcd60e51b815260040161060f90614290565b6001600160a01b038516600090815260ca602052604081206006015460609082136134a7576001600160a01b038716600090815260ca6020526040902060060154915061348182613ac3565b604051602001613491919061481f565b60405160208183030381529060405290506134fc565b6001600160a01b038716600090815260ca60205260409020600601546134cf90600019614466565b91506134da82613ac3565b6040516020016134ea919061483b565b60405160208183030381529060405290505b6001600160a01b0396909616600090815260ca602052604090206003810154600482015460059092015490989197909650945092505050565b613540600033612ba1565b61355c5760405162461bcd60e51b815260040161060f906146ba565b60d080546001600160a01b0319166001600160a01b0392909216919091179055565b613589600033612ba1565b6135a55760405162461bcd60e51b815260040161060f906146ba565b60d280546001600160a01b0319166001600160a01b0392909216919091179055565b606060006135d862015180846143a0565b905060006135e98262010bd9614864565b6135f69062253d8c614864565b9050600062023ab1613609836004614466565b6136139190614496565b905060046136248262023ab1614466565b61362f906003614864565b6136399190614496565b613643908361443f565b9150600062164b09613656846001614864565b61366290610fa0614466565b61366c9190614496565b9050600461367c826105b5614466565b6136869190614496565b613690908461443f565b61369b90601f614864565b9250600061098f6136ad856050614466565b6136b79190614496565b9050600060506136c98361098f614466565b6136d39190614496565b6136dd908661443f565b90506136ea600b83614496565b94506136f785600c614466565b613702836002614864565b61370c919061443f565b9150848361371b60318761443f565b613726906064614466565b6137309190614864565b61373a9190614864565b925061374581613ac3565b61374e83613ac3565b61375785613ac3565b6040516020016137699392919061488c565b6040516020818303038152906040529650505050505050919050565b61378f8282612ba1565b6118cf576137a7816001600160a01b03166014613bcc565b6137b2836020613bcc565b6040516020016137c39291906148e6565b60408051601f198184030181529082905262461bcd60e51b825261060f9160040161495b565b6137f38282612ba1565b6118cf5760008281526065602090815260408083206001600160a01b03851684529091529020805460ff1916600117905561382b3390565b6001600160a01b0316816001600160a01b0316837f2f8788117e7eff1d82e926ec794901d17c78024a50270940304540a733656f0d60405160405180910390a45050565b6138798282612ba1565b156118cf5760008281526065602090815260408083206001600160a01b0385168085529252808320805460ff1916905551339285917ff6391f5c32d9c69d2a47ea670b442974b53935d1edc7fd64eb21e047a839171b9190a45050565b60975460ff1661391f5760405162461bcd60e51b815260206004820152601460248201527314185d5cd8589b194e881b9bdd081c185d5cd95960621b604482015260640161060f565b6097805460ff191690557f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa335b6040516001600160a01b03909116815260200160405180910390a1565b600054610100900460ff1680613982575060005460ff16155b61399e5760405162461bcd60e51b815260040161060f9061471f565b600054610100900460ff161580156139c0576000805461ffff19166101011790555b6139c8613d68565b6139d0613d68565b6139d8613d68565b801561245e576000805461ff001916905550565b600054610100900460ff1680613a05575060005460ff16155b613a215760405162461bcd60e51b815260040161060f9061471f565b600054610100900460ff16158015613a43576000805461ffff19166101011790555b6097805460ff19169055801561245e576000805461ff001916905550565b6118cf82826137e9565b60975460ff1615613a8e5760405162461bcd60e51b815260040161060f90614290565b6097805460ff191660011790557f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a25861394c3390565b606081600003613aea5750506040805180820190915260018152600360fc1b602082015290565b8160005b8115613b145780613afe8161496e565b9150613b0d9050600a836143a0565b9150613aee565b60008167ffffffffffffffff811115613b2f57613b2f613f4e565b6040519080825280601f01601f191660200182016040528015613b59576020820181803683370190505b5090505b8415613bc457613b6e600183614360565b9150613b7b600a86614987565b613b86906030614305565b60f81b818381518110613b9b57613b9b61499b565b60200101906001600160f81b031916908160001a905350613bbd600a866143a0565b9450613b5d565b949350505050565b60606000613bdb836002614373565b613be6906002614305565b67ffffffffffffffff811115613bfe57613bfe613f4e565b6040519080825280601f01601f191660200182016040528015613c28576020820181803683370190505b509050600360fc1b81600081518110613c4357613c4361499b565b60200101906001600160f81b031916908160001a905350600f60fb1b81600181518110613c7257613c7261499b565b60200101906001600160f81b031916908160001a9053506000613c96846002614373565b613ca1906001614305565b90505b6001811115613d19576f181899199a1a9b1b9c1cb0b131b232b360811b85600f1660108110613cd557613cd561499b565b1a60f81b828281518110613ceb57613ceb61499b565b60200101906001600160f81b031916908160001a90535060049490941c93613d12816149b1565b9050613ca4565b5083156116ee5760405162461bcd60e51b815260206004820181905260248201527f537472696e67733a20686578206c656e67746820696e73756666696369656e74604482015260640161060f565b600054610100900460ff1680613d81575060005460ff16155b613d9d5760405162461bcd60e51b815260040161060f9061471f565b600054610100900460ff161580156139d8576000805461ffff1916610101179055801561245e576000805461ff001916905550565b6040518060c00160405280600060ff168152602001600060ff168152602001606081526020016000815260200160008152602001600081525090565b600060208284031215613e2057600080fd5b81356001600160e01b0319811681146116ee57600080fd5b600080600060608486031215613e4d57600080fd5b505081359360208301359350604090920135919050565b80356001600160a01b0381168114611afb57600080fd5b60ff8116811461245e57600080fd5b60008060008060808587031215613ea057600080fd5b8435935060208501359250613eb760408601613e64565b91506060850135613ec781613e7b565b939692955090935050565b60008060408385031215613ee557600080fd5b613eee83613e64565b91506020830135613efe81613e7b565b809150509250929050565b600060208284031215613f1b57600080fd5b5035919050565b60008060408385031215613f3557600080fd5b82359150613f4560208401613e64565b90509250929050565b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f1916810167ffffffffffffffff81118282101715613f8d57613f8d613f4e565b604052919050565b600082601f830112613fa657600080fd5b813567ffffffffffffffff811115613fc057613fc0613f4e565b613fd3601f8201601f1916602001613f64565b818152846020838601011115613fe857600080fd5b816020850160208301376000918101602001919091529392505050565b60008060006060848603121561401a57600080fd5b833561402581613e7b565b9250602084013567ffffffffffffffff8082111561404257600080fd5b61404e87838801613f95565b9350604086013591508082111561406457600080fd5b5061407186828701613f95565b9150509250925092565b60006020828403121561408d57600080fd5b6116ee82613e64565b60005b838110156140b1578181015183820152602001614099565b50506000910152565b600081518084526140d2816020860160208601614096565b601f01601f19169290920160200192915050565b60006020808301818452808551808352604092508286019150828160051b87010184880160005b8381101561417e57603f19898403018552815160c060ff808351168652808a840151168a8701525087820151818987015261414a828701826140ba565b606084810151908801526080808501519088015260a09384015193909601929092525050938601939086019060010161410d565b509098975050505050505050565b60006020828403121561419e57600080fd5b813561ffff811681146116ee57600080fd5b600080600080600060a086880312156141c857600080fd5b8535945060208601359350604086013592506060860135915060808601356141ef81613e7b565b809150509295509295909350565b60006020828403121561420f57600080fd5b81356116ee81613e7b565b6020808252825182820181905260009190848201906040850190845b8181101561425557835160ff1683529284019291840191600101614236565b50909695505050505050565b84815283602082015282604082015260806060820152600061428660808301846140ba565b9695505050505050565b60208082526010908201526f14185d5cd8589b194e881c185d5cd95960821b604082015260600190565b6020808252818101527f436f6e74726163742063616c6c7320617265206e6f7420617661696c61626c65604082015260600190565b634e487b7160e01b600052601160045260246000fd5b808201808211156105e6576105e66142ef565b60208082526028908201527f54696d6520666f72207369676e696e67207472616e73616374696f6e2068617360408201526708195e1c1a5c995960c21b606082015260800190565b818103818111156105e6576105e66142ef565b80820281158282048414176105e6576105e66142ef565b634e487b7160e01b600052601260045260246000fd5b6000826143af576143af61438a565b500490565b6000602082840312156143c657600080fd5b5051919050565b6001600160a01b039384168152919092166020820152604081019190915260600190565b60006020828403121561440357600080fd5b815180151581146116ee57600080fd5b6020808252601290820152712aa9a22a102830bcb6b2b73a1032b93937b960711b604082015260600190565b818103600083128015838313168383128216171561445f5761445f6142ef565b5092915050565b80820260008212600160ff1b84141615614482576144826142ef565b81810583148215176105e6576105e66142ef565b6000826144a5576144a561438a565b600160ff1b8214600019841416156144bf576144bf6142ef565b500590565b600181811c908216806144d857607f821691505b6020821081036144f857634e487b7160e01b600052602260045260246000fd5b50919050565b601f82111561171b57600081815260208120601f850160051c810160208610156145255750805b601f850160051c820191505b8181101561454457828155600101614531565b505050505050565b815167ffffffffffffffff81111561456657614566613f4e565b61457a8161457484546144c4565b846144fe565b602080601f8311600181146145af57600084156145975750858301515b600019600386901b1c1916600185901b178555614544565b600085815260208120601f198616915b828110156145de578886015182559484019460019091019084016145bf565b50858210156145fc5787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b6020808252601c908201527f4465706f7369742074797065206973206f7574206f662072616e676500000000604082015260600190565b60208082526021908201527f4e6f7420656e6f7567682056544920746f6b656e73206f6e20636f6e747261636040820152601d60fa1b606082015260800190565b6001600160a01b03841681526060602082018190526000906146a8908301856140ba565b828103604084015261428681856140ba565b60208082526017908201527f43616c6c6572206973206e6f74207468652041646d696e000000000000000000604082015260600190565b60008060006060848603121561470657600080fd5b8351925060208401519150604084015190509250925092565b6020808252602e908201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160408201526d191e481a5b9a5d1a585b1a5e995960921b606082015260800190565b6000602080838503121561478057600080fd5b825167ffffffffffffffff8082111561479857600080fd5b818501915085601f8301126147ac57600080fd5b8151818111156147be576147be613f4e565b8060051b91506147cf848301613f64565b81815291830184019184810190888411156147e957600080fd5b938501935b83851015614813578451925061480383613e7b565b82825293850193908501906147ee565b98975050505050505050565b60008251614831818460208701614096565b9190910192915050565b602d60f81b815260008251614857816001850160208701614096565b9190910160010192915050565b8082018281126000831280158216821582161715614884576148846142ef565b505092915050565b6000845161489e818460208901614096565b8083019050601760f91b80825285516148be816001850160208a01614096565b600192019182015283516148d9816002840160208801614096565b0160020195945050505050565b7f416363657373436f6e74726f6c3a206163636f756e742000000000000000000081526000835161491e816017850160208801614096565b7001034b99036b4b9b9b4b733903937b6329607d1b601791840191820152835161494f816028840160208801614096565b01602801949350505050565b6020815260006116ee60208301846140ba565b600060018201614980576149806142ef565b5060010190565b6000826149965761499661438a565b500690565b634e487b7160e01b600052603260045260246000fd5b6000816149c0576149c06142ef565b50600019019056fea264697066735822122090e128893e5a9d7003bbbecd6468c5ea1adb8163f4a548df2a9833a30392d3fd64736f6c63430008140033';
        //$contract->setBytecode($contract_bytecode);

//call contract deployment (note the array wrapping in the constructor params)!
//if you don't provide explicit gas price, the system will update current gas price from the net (call)
        $extra_params = [
            'from' => $SWP_ADDRESS,
            'nonce' => $nonce
        ];
        //$checkContract = $contract->call('getUserHistory', ['0x4625Ec57dcF4d2C71D4a1B231df91DA56dd85b22']);
        $resultContract = $contract->send('buyVTIfromBalance',[
            5,
            1,
            '0xa6dee89b9852a4a827b4beaa5b83a8fccecf6216',
            0,
        ],$extra_params);

        echo 'Contract value check: <br/>';
        echo json_encode($resultContract);
    }

    public function getHystoryWallet($wallet){
        $ETHEREUM_NET_ENDPOINT = 'https://bsc-dataseed1.binance.org/';
        $contractAddress = '0x9Fa34d811A3320872fFF11b9F479BE1ac4D4a208';

        $sweb3 = new SWeb3($ETHEREUM_NET_ENDPOINT);
        $sweb3->chainId = 56;//ropsten
        $creation_abi = '[{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"previousAdminRole","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"newAdminRole","type":"bytes32"}],"name":"RoleAdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleGranted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleRevoked","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"inputs":[],"name":"DEFAULT_ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"USDT","outputs":[{"internalType":"contract IERC20Metadata","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"USDTBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"VTI","outputs":[{"internalType":"contract IERC20Metadata","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"VTIBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint8","name":"_programType","type":"uint8"},{"internalType":"string","name":"_name","type":"string"},{"internalType":"string","name":"_date","type":"string"}],"name":"addProgram","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"addUSDT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"addVTI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_USDTAmount","type":"uint256"},{"internalType":"uint256","name":"_VTIPrice","type":"uint256"},{"internalType":"uint256","name":"_timeStamp","type":"uint256"},{"internalType":"uint256","name":"_openLimit","type":"uint256"},{"internalType":"uint8","name":"_code","type":"uint8"}],"name":"buyVTI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_USDTAmount","type":"uint256"},{"internalType":"uint256","name":"_VTIPrice","type":"uint256"},{"internalType":"address","name":"_userAddress","type":"address"},{"internalType":"uint8","name":"_code","type":"uint8"}],"name":"buyVTIfromBalance","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"}],"name":"getAllUserPrograms","outputs":[{"internalType":"uint8[]","name":"","type":"uint8[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"}],"name":"getBuyData","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getMFee","outputs":[{"internalType":"uint16","name":"","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"}],"name":"getMinSellAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"},{"internalType":"uint8","name":"_code","type":"uint8"}],"name":"getProgramBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"},{"internalType":"uint8","name":"_code","type":"uint8"}],"name":"getProgramBuyData","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleAdmin","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"}],"name":"getSellData","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"getUSDT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"}],"name":"getUserHistory","outputs":[{"components":[{"internalType":"uint8","name":"opType","type":"uint8"},{"internalType":"uint8","name":"opCode","type":"uint8"},{"internalType":"string","name":"opDate","type":"string"},{"internalType":"uint256","name":"VTIAmount","type":"uint256"},{"internalType":"uint256","name":"VTIPrice","type":"uint256"},{"internalType":"uint256","name":"totalUSDT","type":"uint256"}],"internalType":"struct INDEX_v5.HistoryRecord[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"getVTI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_userAddress","type":"address"}],"name":"getVTIBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"grantRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"hasRole","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"pause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"renounceRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"revokeRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_VTIAmount","type":"uint256"},{"internalType":"uint256","name":"_VTIPrice","type":"uint256"},{"internalType":"uint256","name":"_timeStamp","type":"uint256"}],"name":"sellVTI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_backAddress","type":"address"}],"name":"setBackAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint16","name":"_expTime","type":"uint16"}],"name":"setExpirationTime","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint16","name":"_newMFee","type":"uint16"}],"name":"setMFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_programsContract","type":"address"}],"name":"setProgramsContractAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint16","name":"_newSFee","type":"uint16"}],"name":"setSFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_systemWallet","type":"address"}],"name":"setSystemWallet","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_USDTContract","type":"address"}],"name":"setUSDTContractAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_VTIContract","type":"address"}],"name":"setVTIContractAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"unpause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint8","name":"_code","type":"uint8"}],"name":"withdrawFromProgram","outputs":[],"stateMutability":"nonpayable","type":"function"}]';

        $contract = new SWeb3_contract($sweb3, $contractAddress, $creation_abi);
        $checkContract = $contract->call('getUserHistory', [$wallet]);
        return $checkContract;
    }
    public function formaterDataEth($data) {
        $VTIprice = $data['_VTIPrice'];
        $timestamp = $data['_timeStamp'];

        $packageType = $data['packageType'];

        $purefiPackage = '';
        $VTIpricePacked = pack("H64", $VTIprice);
        $timestampPacked = pack("N", $timestamp);
        $timestampBn = gmp_init($timestamp);

        if($packageType == 'buy'){
            $openLimitPacked = pack("H64", $data['_openLimit']);
            $purefiPackage = $VTIpricePacked . $timestampPacked . $openLimitPacked;
        }elseif($packageType == 'sell'){
            $purefiPackage = $VTIpricePacked . $timestampPacked;
        }

        $message = pack("Qa*", $timestampBn, $purefiPackage);

        $signature = $this->signMessage($message);  // Assuming you have a signMessage function

        $purefiData = pack("Qa*a*", $timestampBn, $signature, $purefiPackage);

        return $purefiData;
    }

    public function signMessage($message, $privateKey) {
        $signature = '';
        openssl_sign($message, $signature, $privateKey, OPENSSL_ALGO_SHA256);
        return $signature;
    }
}
